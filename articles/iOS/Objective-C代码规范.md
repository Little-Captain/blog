Title: Objective-C 代码规范
Date: 2017-06-13 16:47:09
Category: iOS
Tags: Objective-C, 代码规范

排版
===

* 程序块要采用缩进风格编写，缩进的空格数为4个。对齐只使用空格键，不使用TAB键。
* 相对独立的程序块之间、变量说明之后必须加空行。
* 较长的语句要分成多行书写，长表达式要在低优先级操作符处划分新行，操作符放在新行之首，划分出的新行要进行适当的缩进，使排版整齐，语句可读。
* 不允许把多个短语句写在一行中，即一行只写一条语句。
* 大括号添加规则(if、for、函数、方法 ...)

```objc
if (...) {

    // 代码开始
}
```

* 在两个以上的关键字、变量、常量进行对等操作时，它们之间的操作符之前、 之后或者前后要加空格;进行非对等操作时，如果是关系密切的立即操作符(++、&、! ...)，后不应加空格。
* 一行程序以小于80字符为宜，不要写得过长。
* block 调用规范

```objc
!_block ? : _block(...);
```

* 方法声明规则: 一个参数一行

```objc
- (NSURLSessionDataTask *)upload:(NSString *)URLString
                      parameters:(nullable id)parameters
                            name:(NSString *)name
                        fileName:(nullable NSString *)fileName
                            data:(NSData *)data
                        progress:(nullable void (^)(float progress))progress;
```

注释
===

* 添加必要注释, 尽量做到代码自注释, 通过语义清晰的命名来实现
* 方法函数的注释, 使用 Xcode 生成的标准注释

```objc
/**
 上传文件方法 : 监听进度
 
 @param URLString  URL 字符串
 @param parameters 请求参数
 @param name       接收上传数据的服务器字段(要咨询公司的服务器人员)
 @param fileName   保存在服务器的文件名(需要和服务器人员约定, 本方法内部实现使用这个参数决定上传的 MimeType)
 @param data       要上传的二进制数据
 @param progress   请求进度回调: progress 为进度值
 @param completion 请求完成后的回调闭包
 isSuccess == YES : result 为 响应的具体数据
 isSuccess == NO  : result 为 错误信息对象(NSError)
 */
```

* 注释应与其描述的代码相近，对代码的注释应放在其上方或右方(对单条语句的注释)相邻位置
* 对于所有有物理含义的变量、常量，如果其命名不是充分自注释的，在声明时都必须加以注释，说明其物理含义。变量、常量、宏的注释应放在其上方相邻位置或右方。
* 注释与所 述内容进行同样的缩排。
* 对变量的定义和分支语句(条件分支、循环语句等)必须编写注释。
* 避免在一行代码或表达式的中间插入注释。
* 通过对方法、函数、变量、结构等正确的命名以及合理地组织代码的结构，使代码成为自注释的。
* 在代码的功能、意图层次上进行注释， 供有用、额外的信息。
* 在程序块的结束行右方加注释标记，以表明某程序块的结束。

```objc
if (...) {

    // end of if (...)
} else {

    // end of if (...) else
}
```

标识符命名
========

* 标识符的命名要清晰、明了，有明确含义，同时使用完整的单词或大家基本可以 理解的缩写，避免使人产生误解。
* 命名中若使用特殊约定或缩写，则要有注释说明。
* 对于变量命名，禁止取单个字符，但i、j、k作局部循环变量是允许的。
* 命名规范

```objc
// 一般变量 : 小驼峰命名法
NSString *fileName= @"xxx";
// 全局静态常量 : 大驼峰命名法
NSString * const FileName= @"xxx";
// 宏 : k开头
#define kFileName @"xxx"
```

可读性
=====

* 注意运算符的优先级，并用括号明确表达式的操作顺序，避免使用默认优先级。
* 避免使用不易理解的数字，用有意义的标识来替代。涉及物理状态或者含有物理意义的常量，不应直接使用数字，必须用有意义的枚举、const常量、宏来代替。
* 源程序中关系较为紧密的代码应尽可能相邻。
* 不要使用难懂的技巧性很高的语句，除非很有必要时。

方法(函数)
========

* 方法的规模尽量限制在200行以内。
* 一个方法仅完成一件功能。
* 为简单功能编写方法。
* 不要设计多用途面面俱到的方法。
* 方法的功能应该是可以预测的，也就是只要输入数据相同就应产生同样的输出。
* 检查方法所有参数输入的有效性。
* 检查方法所有非参数输入的有效性，如文件文件、公共变量等。
* 防止把没有关联的语句放到一个方法中。
* 如果多段代码重复做同一件事情，那么在方法的划分上可能存在问题。
* 功能不明确较小的方法，特别是仅有一个上级方法调用它时，应考虑把它合并到上级方法中，而不必单独存在。
* 对于提供了返回值的方法，在引用时最好使用其返回值。

质量保证
=======

* 在软件设计过程中构筑软件质量。不要等到软件已基本成型后, 再来提高质量
* 代码质量保证优先原则
    * 正确性，指程序要实现设计要求的功能。
    * 稳定性、安全性，指程序稳定、可靠、安全。
    * 可测试性，指程序要具有良好的可测试性。
    * 规范/可读性，指程序书写风格、命名规则等要符合规范。
    * 全局效率，指软件系统的整体效率。
    * 局部效率，指某个模块/子模块/函数的本身效率。
    * 个人表达方式/个人方便性，指个人编程习惯。
* 只引用属于自己的存贮空间。
* 防止引用已经释放的内存空间(僵尸对象、野指针)。
* 防止内存操作越界(数组越界)。
* 认真处理程序所能遇到的各种出错情况(容错处理, 很重要, iOS App 莫名崩溃的常见原因)。
* 不能随意改变与其它模块的接口。但可以指明废弃接口, 添加新接口。
* 要时刻注意易混淆的操作符。当编完程序后，应从头至尾检查一遍这些操作符， 以防止拼写错误。

```objc
// & 与 &&
// | 与 ||
// = 与 ==
if (3 == a) {
    
    // ... 
}
```

* 有可能的话，if 语句尽量加上 else 分支，对没有 else 分支的语句要小心对待; switch 语句必须有default 分支。
* 不要使用 goto 语句。
* 时刻注意表达式是否会上溢、下溢。
* 系统应具有一定的容错能力，对一些错误事件(如用户误操作等)能进行自动补救。

宏
===

* 用宏定义表达式时，要使用完备的括号。

```objc
#define RECTANGLE_AREA( a, b ) ((a) * (b))
```



